---
- name: Selfhealing playbook
  hosts: All
  vars:
    tenanturl: https://stg99002.live.dynatrace.com
    apitoken: Ur8ti8_9SLWYpfXSTDNgH
    dtproblemURL: "https://stg99002.live.dynatrace.com/api/v1/problem/status"
    
tasks:
    - name: Count of problems
      uri:
        url: "{{dtproblemURL}}"
        method: Get
tasks:
  - name: read JSON of problem status
    url: "{{dtproblemURL}}"
    method: Get
    debug:
      msg: "There is problem with service"
    when:
      (result.totalOpenProblemsCount == "1")    

 - name: Starting easytravel
    service:
       name: easytravel
       state: started 
	  
